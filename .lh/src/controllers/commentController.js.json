{
    "sourceFile": "src/controllers/commentController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762458437728,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762458437728,
            "name": "Commit-0",
            "content": "// blog-backend/src/controllers/commentController.js\nconst Comment = require(\"../models/Comment\");\nconst Blog = require(\"../models/Blog\");\n\n// -------- PUBLIC --------\n\n// POST /api/comments\n// body: { postId, name, email, message }\nexports.createPublic = async (req, res) => {\n  try {\n    const { postId, name, email, message } = req.body || {};\n    if (!postId || !name || !email || !message) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // sanity: make sure blog exists\n    const exists = await Blog.findById(postId).lean();\n    if (!exists) return res.status(404).json({ error: \"Post not found\" });\n\n    const comment = await Comment.create({ post: postId, name, email, message });\n    res.status(201).json({ ok: true, id: comment._id });\n  } catch (err) {\n    console.error(\"createPublic comment error\", err);\n    res.status(500).json({ error: \"Server error\" });\n  }\n};\n\n// GET /api/comments?postId=...  (approved only)\nexports.listPublic = async (req, res) => {\n  try {\n    const { postId } = req.query;\n    if (!postId) return res.status(400).json({ error: \"postId required\" });\n\n    const rows = await Comment.find({ post: postId, approved: true })\n      .sort({ createdAt: 1 })\n      .lean();\n    res.json(rows);\n  } catch (err) {\n    console.error(\"listPublic comments error\", err);\n    res.status(500).json({ error: \"Server error\" });\n  }\n};\n\n// -------- ADMIN --------\n\n// GET /api/admin/comments?postId=...&approved=true|false (optional filters)\nexports.listAdmin = async (req, res) => {\n  try {\n    const { postId, approved } = req.query;\n    const q = {};\n    if (postId) q.post = postId;\n    if (typeof approved !== \"undefined\") q.approved = approved === \"true\";\n\n    const rows = await Comment.find(q)\n      .populate(\"post\", \"title slug\")\n      .sort({ createdAt: -1 })\n      .lean();\n\n    res.json(rows);\n  } catch (err) {\n    console.error(\"listAdmin comments error\", err);\n    res.status(500).json({ error: \"Server error\" });\n  }\n};\n\n// PUT /api/admin/comments/:id/approve\nexports.approve = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const row = await Comment.findByIdAndUpdate(\n      id,\n      { $set: { approved: true } },\n      { new: true }\n    );\n    if (!row) return res.status(404).json({ error: \"Not found\" });\n    res.json({ ok: true });\n  } catch (err) {\n    console.error(\"approve comment error\", err);\n    res.status(500).json({ error: \"Server error\" });\n  }\n};\n\n// DELETE /api/admin/comments/:id\nexports.remove = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const row = await Comment.findByIdAndDelete(id);\n    if (!row) return res.status(404).json({ error: \"Not found\" });\n    res.json({ ok: true });\n  } catch (err) {\n    console.error(\"delete comment error\", err);\n    res.status(500).json({ error: \"Server error\" });\n  }\n};\n"
        }
    ]
}